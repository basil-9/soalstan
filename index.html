<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ø¤Ø§Ù„Ø³ØªØ§Ù† - Ø§Ù„Ù…Ø²Ø§Ø¯ Ø§Ù„Ù…Ø·ÙˆØ± Ø¨Ù…Ø³ØªÙˆÙŠØ§Øª</title>
    <style>
        :root { --bg-blue: #1e40af; --gold: #facc15; --gold-dark: #ca8a04; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; text-align: center; background: radial-gradient(circle, #1e40af 0%, #1e3a8a 100%); margin: 0; min-height: 100vh; color: white; overflow-x: hidden; }
        
        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª */
        .screen { display: none; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .active-screen { display: flex; }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø²Ø§Ø¯ (Ø§Ù„ÙƒØ§Ø±Ø¯) */
        .card { background: white; padding: 30px; border-radius: 25px; display: inline-block; width: 95%; max-width: 650px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); color: #333; }
        
        /* Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© ÙˆÙ†Ù‚Ø§Ø· Ø§Ù„ÙØ±Ù‚ */
        .header { display: flex; justify-content: space-between; margin-bottom: 25px; font-weight: bold; font-size: 20px; }
        .team-a-label { color: #1e3a8a; } .team-b-label { color: #dc2626; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ù†Ù…Ø· ÙƒÙ„Ùƒ) */
        .btn-main { background: var(--gold); color: #000; padding: 15px 40px; font-size: 22px; font-weight: bold; border: 4px solid #000; border-radius: 12px; cursor: pointer; box-shadow: 0 8px 0 var(--gold-dark); transition: 0.1s; margin: 10px; }
        .btn-main:active { transform: translateY(4px); box-shadow: 0 4px 0 var(--gold-dark); }
        .btn-blue { background: #3b82f6; box-shadow: 0 8px 0 #1d4ed8; color: white; }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ‚ */
        .teams-container { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; justify-content: center; }
        .team-card { background: #f8fafc; color: #000; padding: 20px; border: 5px solid #000; border-radius: 20px; cursor: pointer; transition: 0.3s; width: 140px; }
        .team-card:hover { transform: scale(1.05); }
        .avatar { width: 70px; height: 70px; border-radius: 50%; margin: 0 auto 10px; border: 3px solid #000; }

        /* Ø§Ù„Ù…Ø²Ø§Ø¯ ÙˆØ§Ù„Ù„Ø¹Ø¨ */
        .auction-box { background: #fffbeb; border: 2px solid #fbbf24; padding: 20px; border-radius: 15px; margin: 20px 0; }
        .q-img { width: 250px; height: auto; filter: blur(25px); transition: 3s ease-in-out; margin: 15px; border-radius: 10px; }
        .options-grid { display: none; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .opt-btn { padding: 18px; font-size: 18px; background: #2563eb; color: white; border: none; border-radius: 12px; cursor: pointer; transition: 0.2s; }
        .bid-btn { background: #dc2626; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #timer-box { font-size: 28px; font-weight: bold; color: #e74c3c; margin: 10px 0; }
        .level-badge { padding: 5px 15px; border-radius: 20px; font-size: 14px; color: white; display: inline-block; margin-bottom: 10px; }
        .easy { background: #27ae60; } .medium { background: #f39c12; } .hard { background: #c0392b; }
    </style>
</head>
<body>

<div id="join-screen" class="screen active-screen">
    <div class="card">
        <h1>ğŸ”¨ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø³Ø¤Ø§Ù„Ø³ØªØ§Ù† ğŸ”¨</h1>
        <p>Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ø¯</p>
        
        <input type="text" id="player-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." 
               style="padding: 15px; width: 80%; border-radius: 12px; border: 4px solid #000; font-size: 18px; text-align: center; margin-bottom: 20px;">

        <div class="teams-container">
            <div class="team-card" style="border-color: #1e3a8a;" onclick="joinGame('Ø£')">
                <div class="avatar" style="background: #3b82f6;"></div>
                <strong>ÙØ±ÙŠÙ‚ Ø£</strong>
            </div>
            <div class="team-card" style="border-color: #dc2626;" onclick="joinGame('Ø¨')">
                <div class="avatar" style="background: #ef4444;"></div>
                <strong>ÙØ±ÙŠÙ‚ Ø¨</strong>
            </div>
        </div>
    </div>
</div>

<div id="main-game-screen" class="screen">
    <div class="card">
        <h2 id="welcome-msg">Ù…Ø±Ø­Ø¨Ø§Ù‹</h2>
        
        <div class="header">
            <div class="team-a-label">ÙØ±ÙŠÙ‚ Ø£: <span id="pts-Ø£">100</span></div>
            <div id="timer-box" style="display:none;">â±ï¸ <span id="seconds">15</span></div>
            <div class="team-b-label">ÙØ±ÙŠÙ‚ Ø¨: <span id="pts-Ø¨">100</span></div>
        </div>

        <div id="level-selector">
            <p>Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ø¯:</p>
            <button class="btn-main easy" style="font-size:16px; padding:10px;" onclick="requestNewAuction('easy')">Ø³Ù‡Ù„</button>
            <button class="btn-main medium" style="font-size:16px; padding:10px;" onclick="requestNewAuction('medium')">Ù…ØªÙˆØ³Ø·</button>
            <button class="btn-main hard" style="font-size:16px; padding:10px;" onclick="requestNewAuction('hard')">ØµØ¹Ø¨</button>
        </div>

        <div class="auction-box" id="auction-container">
            <div id="current-level-display"></div>
            <h3 id="hint-label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰...</h3>
            <div id="bid-ui" style="display:none;">
                <p>Ø§Ù„Ù…Ø²Ø§Ø¯: <mark id="high-bid">0</mark> Ø¨ÙˆØ§Ø³Ø·Ø© <span id="high-team">-</span></p>
                <button class="bid-btn" onclick="bid(10)">+10</button>
                <button class="bid-btn" onclick="bid(20)">+20</button>
                <button id="win-auction" style="background:#000; color:#fff; border:none; padding:10px; border-radius:8px; cursor:pointer;" onclick="win()">Ø¥Ø±Ø³Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ø¯ ğŸ</button>
            </div>
        </div>

        <div id="game-play" style="display:none;">
            <h2 id="question-text"></h2>
            <img id="question-image" class="q-img" src="" style="display:none;">
            <div class="options-grid" id="options-container"></div>
        </div>
        
        <div id="result-msg" style="margin-top:20px; font-size:22px; font-weight:bold;"></div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let myTeam, myName, currentQ, currentBid = 0, timerInterval;

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©
    function joinGame(teamLetter) {
        const nameInput = document.getElementById('player-name').value.trim();
        if (!nameInput) { alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„!"); return; }
        
        myName = nameInput;
        myTeam = teamLetter;
        
        document.getElementById('welcome-msg').innerText = `Ø§Ù„Ø¨Ø·Ù„ ${myName} (ÙØ±ÙŠÙ‚ ${myTeam})`;
        document.getElementById('join-screen').classList.remove('active-screen');
        document.getElementById('main-game-screen').classList.add('active-screen');
        
        // Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        socket.emit('playerJoin', { name: myName, team: myTeam });
    }

    socket.on('init', data => {
        document.getElementById(`pts-Ø£`).innerText = data.pointsA || 100;
        document.getElementById(`pts-Ø¨`).innerText = data.pointsB || 100;
    });

    function requestNewAuction(level) { socket.emit('requestAuction', { level: level }); }

    socket.on('startAuction', data => {
        const levelsInfo = { 'easy': 'Ø³Ù‡Ù„', 'medium': 'Ù…ØªÙˆØ³Ø·', 'hard': 'ØµØ¹Ø¨' };
        document.getElementById('current-level-display').innerHTML = `<span class="level-badge ${data.level}">${levelsInfo[data.level]}</span>`;
        document.getElementById('hint-label').innerText = "ØªÙ„Ù…ÙŠØ­: " + data.hint;
        document.getElementById('bid-ui').style.display = "block";
        document.getElementById('game-play').style.display = "none";
        document.getElementById('timer-box').style.display = "none";
        document.getElementById('result-msg').innerText = "";
        currentQ = data.fullQuestion;
        currentBid = 0;
    });

    function bid(amount) {
        currentBid += amount;
        socket.emit('placeBid', { team: myTeam, amount: currentBid, name: myName });
    }

    socket.on('updateBid', data => {
        document.getElementById('high-bid').innerText = data.amount;
        document.getElementById('high-team').innerText = `${data.name} (ÙØ±ÙŠÙ‚ ${data.team})`;
    });

    function win() { socket.emit('winAuction', { question: currentQ }); }

    socket.on('revealQuestion', data => {
        const q = data.question;
        document.getElementById('bid-ui').style.display = "none";
        document.getElementById('game-play').style.display = "block";
        document.getElementById('timer-box').style.display = "block";
        document.getElementById('question-text').innerText = q.q;
        
        startTimer(data.duration);

        const imgElement = document.getElementById('question-image');
        if(q.type === 'image') {
            imgElement.src = q.img;
            imgElement.style.display = "inline";
            imgElement.style.filter = "blur(25px)";
            setTimeout(() => imgElement.style.filter = "blur(0px)", 100); 
        } else { imgElement.style.display = "none"; }

        const container = document.getElementById('options-container');
        container.innerHTML = ''; container.style.display = 'grid';
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => {
                clearInterval(timerInterval);
                socket.emit('submitAnswer', { team: myTeam, answer: opt, correct: q.a, name: myName });
            };
            container.appendChild(btn);
        });
    });

    function startTimer(seconds) {
        let timeLeft = seconds;
        document.getElementById('seconds').innerText = timeLeft;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('seconds').innerText = timeLeft;
            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                document.getElementById('result-msg').innerText = "âŒ› Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!";
                document.getElementById('options-container').style.display = 'none';
            }
        }, 1000);
    }

    socket.on('roundResult', data => {
        clearInterval(timerInterval);
        const status = data.isCorrect ? "âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©" : "âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©";
        document.getElementById('result-msg').innerText = `${data.playerName}: ${status}`;
        document.getElementById(`pts-${data.team}`).innerText = data.points;
        document.getElementById('options-container').style.display = 'none';
    });
</script>
</body>
</html>